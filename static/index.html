<html>
<head>
</head>
<body>
<div id="video_container"></div>
<p id="info"></p>
<script>
  window.onload = function () {
    function u8tohex (arr) {
      var vals = [ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' ]
      var ret = ''
      for (var i = 0; i < arr.length; ++i) {
        ret += vals[(arr[i] & 0xf0) / 0x10]
        ret += vals[(arr[i] & 0x0f)]
      }
      return ret
    }

    var idBytes = new Uint8Array(16)
    crypto.getRandomValues(idBytes)
    var id = u8tohex(idBytes)
    var receiver = 'http://localhost:8080/pay/' + id

    console.log('run `monetize({ receiver: "' + receiver + '" })`')

    window.monetize({
      receiver
    })

    var sourceEl = document.createElement('source')
    var videoEl = document.createElement('video')
    videoEl.id = 'buffering_video'
    videoEl.width = 500
    videoEl.controls = true
    sourceEl.type = 'video/mp4'
    sourceEl.src = 'http://localhost:8080/video/123/' + id
    videoEl.appendChild(sourceEl)
    document.getElementById('video_container').appendChild(videoEl)

    vid = document.getElementById('buffering_video')
    p = document.getElementById('info')
    setInterval(() => {
      p.innerHTML = vid.buffered.end(0)
    }, 1000)
  }
</script>
</body>
</html>
